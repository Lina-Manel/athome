<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Islamic Red vs Blue Game</title>
<style>
  body { font-family: Arial; background:#f5f5f5; text-align:center; }
  h1 { margin-top:20px; }
  .screen { display:none; padding:20px; }
  .active { display:block; }
  .team-btn { padding:20px 40px; margin:20px; font-size:22px; border:none; color:white; border-radius:15px; cursor:pointer; }
  .red { background:#c62828; }
  .blue { background:#1565c0; }
  .section { background:white; padding:15px; margin:10px auto; width:80%; max-width:400px; border-radius:12px; cursor:pointer; box-shadow:0 2px 4px rgba(0,0,0,0.1); }
  .locked { background:#ddd; cursor:not-allowed; }
  #questionBox { background:white; padding:20px; width:85%; max-width:500px; margin:20px auto; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.2); }
  button { padding:12px 20px; margin-top:20px; font-size:18px; cursor:pointer; }
</style>
</head>
<body>

<h1>Red vs Blue Islamic Game</h1>

<!-- TEAM SELECTION -->
<div id="teamScreen" class="screen active">
  <h2>Choose your team</h2>
  <p id="teamStatus">Waiting for both teams to join...</p>
  <button class="team-btn red" onclick="joinTeam('red')">Red Team üî¥</button>
  <button class="team-btn blue" onclick="joinTeam('blue')">Blue Team üîµ</button>
</div>

<!-- SECTIONS SCREEN -->
<div id="sectionScreen" class="screen">
  <h2>Pick a Section</h2>
  <div id="sections"></div>
</div>

<!-- QUESTION SCREEN -->
<div id="questionScreen" class="screen">
  <div id="questionBox"></div>
</div>

<!-- SCORE SCREEN -->
<div id="scoreScreen" class="screen">
  <h2>Final Score</h2>
  <p id="scoreText"></p>
  <button onclick="resetGame()">Restart</button>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
/* ===========================
   FIREBASE CONFIG
=========================== */
const firebaseConfig = {
  apiKey: "AIzaSyAKP0ovl9ZERz9pHgdy-bNSD8GDtvDjmnc",
  authDomain: "athome-8dca5.firebaseapp.com",
  databaseURL: "https://athome-8dca5-default-rtdb.firebaseio.com",
  projectId: "athome-8dca5",
  storageBucket: "athome-8dca5.firebasestorage.app",
  messagingSenderId: "720555193634",
  appId: "1:720555193634:web:262b9a01b9dc3191cca17b"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* ===========================
   GAME DATA
=========================== */
let gameState = {
  team: null,
  connected: false
};

const sections = {
  "ÿßŸÑŸÜÿ∏ÿßŸÅÿ© ŸÅŸä ÿßŸÑÿ•ÿ≥ŸÑÿßŸÖ": ["ŸÑŸÖÿßÿ∞ÿß Ÿäÿπÿ™ÿ®ÿ± ÿßŸÑÿ•ÿ≥ŸÑÿßŸÖ ÿßŸÑŸÜÿ∏ÿßŸÅÿ© ÿ¨ÿ≤ÿ°Ÿãÿß ŸÖŸÜ ÿßŸÑÿ•ŸäŸÖÿßŸÜÿü","ÿßÿ∞ŸÉÿ± ŸÖÿ´ÿßŸÑŸãÿß ŸÖŸÜ ÿßŸÑÿ≥ŸÜÿ© ŸäÿØŸÑ ÿπŸÑŸâ ÿ£ŸáŸÖŸäÿ© ÿßŸÑŸÜÿ∏ÿßŸÅÿ©."],
  "ÿßŸÑÿ™ÿ±ŸÅ ŸàÿßŸÑŸÖÿ∏ÿßŸáÿ± ÿßŸÑŸàÿ´ŸÜŸäÿ©": ["ŸÖÿß ŸáŸà ŸÖŸàŸÇŸÅ ÿßŸÑÿ•ÿ≥ŸÑÿßŸÖ ŸÖŸÜ ÿßŸÑŸÖÿ®ÿßŸÑÿ∫ÿ© ŸÅŸä ÿßŸÑÿ≤ŸäŸÜÿ©ÿü","ŸÑŸÖÿßÿ∞ÿß Ÿäÿ≠ÿ∞ÿ± ÿßŸÑÿ•ÿ≥ŸÑÿßŸÖ ŸÖŸÜ ÿßŸÑÿ™ÿ¥ÿ®Ÿá ÿ®ÿßŸÑŸàÿ´ŸÜŸäŸäŸÜÿü"],
  "ÿ¢ŸÜŸäÿ© ÿßŸÑÿ∞Ÿáÿ® ŸàÿßŸÑŸÅÿ∂ÿ©": ["ŸÖÿß ÿ≠ŸÉŸÖ ÿßŸÑÿ£ŸÉŸÑ ÿ£Ÿà ÿßŸÑÿ¥ÿ±ÿ® ŸÅŸä ÿ£ŸàÿßŸÜŸä ÿßŸÑÿ∞Ÿáÿ® ŸàÿßŸÑŸÅÿ∂ÿ©ÿü","ÿßÿ∞ŸÉÿ± ÿ≥ÿ®ÿ®Ÿãÿß ŸÖŸÜ ÿ£ÿ≥ÿ®ÿßÿ® ÿßŸÑÿ™ÿ≠ÿ±ŸäŸÖ."],
  "ÿ™ÿ¥ÿÆŸäÿµ Ÿàÿ™ŸÖÿßÿ´ŸäŸÑ": ["ŸÖÿß ÿ≠ŸÉŸÖ ÿßŸÑÿ™ŸÖÿßÿ´ŸäŸÑ ÿßŸÑŸÖÿ¨ÿ≥ŸÖÿ© ŸÅŸä ÿßŸÑÿ•ÿ≥ŸÑÿßŸÖÿü","ŸáŸÑ Ÿäÿ¨Ÿàÿ≤ Ÿàÿ∂ÿπ ÿßŸÑÿ™ŸÖÿßÿ´ŸäŸÑ ŸÑŸÑÿ≤ŸäŸÜÿ© ŸÅŸÇÿ∑ÿü ŸàŸÑŸÖÿßÿ∞ÿßÿü"],
  "ÿµŸàÿ± Ÿàÿ±ÿ≥ŸàŸÖÿßÿ™": ["ŸÖÿß ÿßŸÑŸÅÿ±ŸÇ ÿ®ŸäŸÜ ÿßŸÑÿµŸàÿ± ÿßŸÑŸÅŸàÿ™Ÿàÿ∫ÿ±ÿßŸÅŸäÿ© ŸàÿßŸÑŸÖÿ±ÿ≥ŸàŸÖÿ©ÿü","ŸáŸÑ Ÿäÿ¨Ÿàÿ≤ ÿ™ÿπŸÑŸäŸÇ ÿßŸÑÿµŸàÿ± ÿπŸÑŸâ ÿßŸÑÿ¨ÿØÿ±ÿßŸÜÿü"],
  "ÿßŸÇÿ™ŸÜÿßÿ° ÿßŸÑŸÉŸÑÿßÿ®": ["ŸÖÿß ÿ≠ŸÉŸÖ ÿßŸÇÿ™ŸÜÿßÿ° ÿßŸÑŸÉŸÑÿßÿ® ÿ®ÿØŸàŸÜ ÿ≠ÿßÿ¨ÿ©ÿü","ÿßÿ∞ŸÉÿ± ÿßŸÑÿ≠ÿßŸÑÿßÿ™ ÿßŸÑÿ™Ÿä Ÿäÿ¨Ÿàÿ≤ ŸÅŸäŸáÿß ÿßŸÇÿ™ŸÜÿßÿ° ÿßŸÑŸÉŸÑÿßÿ®."]
};

const maxPerTeam = Math.ceil(Object.keys(sections).length / 2);

/* ===========================
   CONNECTION CHECK
=========================== */

// Create unique ID for device
const myID = "u_" + Math.random().toString(36).substr(2, 9);

// Register as connected
db.ref("game/players/" + myID).set(true);

// Remove when leaving
window.addEventListener("beforeunload", () => {
  db.ref("game").remove(); // Auto reset when leaving
});

/* ===========================
   TEAM JOIN
=========================== */
function joinTeam(team) {
  gameState.team = team;
  db.ref("game/team/" + team).set({ joined: true });
}

/* Listen to team join */
db.ref("game/team").on("value", snap => {
  const data = snap.val() || {};
  const redJoined = data.red?.joined;
  const blueJoined = data.blue?.joined;

  document.getElementById("teamStatus").innerHTML =
    `Red: ${redJoined ? "‚úîÔ∏è" : "‚ùå"} | Blue: ${blueJoined ? "‚úîÔ∏è" : "‚ùå"}`;

  if (redJoined && blueJoined && gameState.team) {
    showScreen("sectionScreen");
    loadSections();
  }
});

/* ===========================
   SECTIONS
=========================== */

db.ref("game/lockedSections").on("value", snap => {
  gameState.locked = snap.val() || {};
  loadSections();
});

function loadSections() {
  const container = document.getElementById("sections");
  container.innerHTML = "";

  const locked = gameState.locked || {};

  Object.keys(sections).forEach(sec => {
    const div = document.createElement("div");
    div.className = "section";

    if (locked[sec]) {
      div.innerHTML = sec + " ‚ùå (Taken)";
      div.classList.add("locked");
    } else {
      div.innerHTML = sec;
      div.onclick = () => pickSection(sec);
    }

    container.appendChild(div);
  });
}

function pickSection(sec) {
  if (gameState.locked?.[sec]) return;

  db.ref("game/lockedSections/" + sec).set(gameState.team);

  const q = sections[sec][Math.floor(Math.random() * sections[sec].length)];
  showQuestion(q);
}

/* ===========================
   QUESTIONS
=========================== */

function showQuestion(q) {
  showScreen("questionScreen");
  document.getElementById("questionBox").innerHTML = `
    <h3>${gameState.team === "red" ? "Red üî¥" : "Blue üîµ"}</h3>
    <p>${q}</p>
    <button onclick="answer(true)">Correct ‚úîÔ∏è</button>
    <button onclick="answer(false)">Wrong ‚ùå</button>
  `;
}

/* ===========================
   ANSWERS + END GAME
=========================== */

db.ref("game").on("value", snap => {
  const data = snap.val() || {};
  if (data.showScore) showScore();
});

function answer(correct) {
  if (correct) {
    const scorePath = "game/" + (gameState.team === "red" ? "redScore" : "blueScore");
    db.ref(scorePath).transaction(v => (v || 0) + 1);
  }

  db.ref("game/lockedSections").once("value").then(snap => {
    const total = Object.keys(snap.val() || {}).length;
    if (total === Object.keys(sections).length) {
      db.ref("game/showScore").set(true); // Notify BOTH devices
    } else {
      showScreen("sectionScreen");
      loadSections();
    }
  });
}

/* ===========================
   SCORE SCREEN
=========================== */
function showScore() {
  showScreen("scoreScreen");

  db.ref("game").once("value").then(snap => {
    const d = snap.val() || {};
    document.getElementById("scoreText").innerHTML = `
      üî¥ Red: ${d.redScore || 0}<br>
      üîµ Blue: ${d.blueScore || 0}<br><br>
      <b>Winner: ${
        d.redScore > d.blueScore ? "Red üî¥" :
        d.blueScore > d.redScore ? "Blue üîµ" : "Tie ü§ù"
      }</b>
    `;
  });
}

/* ===========================
   RESET GAME
=========================== */
function resetGame() {
  db.ref("game").remove();
  window.location.reload();
}

/* ===========================
   SCREEN SWITCH
=========================== */
function showScreen(id) {
  document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}
</script>

</body>
</html>

